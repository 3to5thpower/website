---
title: "ファンコミュニケーションズ オンラインインターン参加記"
date: 2020-08-11T18:00:00+09:00
draft: false
toc: true
tags: ["インターン", "Rust"]
categories: ["technologies"]
---

株式会社ファンコミュニケーションズさんで  
8月3日から7日までの5日間オンラインインターンをさせていただいたので、  
参加記をまとめたいと思います。


## 参加の経緯
サポーターズさんの22卒対象エンジニア1on1面談イベントで、  
趣味でRustでCコンパイラを作っているという話をしたところ、  
インターンにRustの枠を新しく設けて参加させていただけるというお誘いをいただき、  
参加する運びとなりました。

やー本当に、ありがたいお話です…！

選考は一応エントリーシートの提出, 面接, 技術テストと、  
恐らく普通のインターンと同じような段取りで行われていたと思います。  
(今回が初めてなので確証はないですが…)  

こんな感じで選考を終え、インターン初日を迎えました。
## 成果物
その前に作ったものを説明します。
DSPと呼ばれるWeb広告の配信仲介サーバです。  

スマホなどでポップアップで広告を表示するアプリは、SSPと呼ばれるサーバに表示する広告をリクエストします。  
SSPはそれを受けて複数のDSPに広告をリクエストします。  
それぞれのDSPから渡された広告の中で最も入札金額が高いものがSSPの返却する広告として選ばれるっぽいです。    

DSPの話に戻りますが、SSPに広告を選ばせるために、  
DSPはSSPからリクエストされると持っている広告データの中から適切な広告を1つ選んで返却します。  
広告データには入札金額などは定められていないので、DSPの中でいい感じに決定します。
(ここで機械学習などが使われます。)  

{{< figure src="/img/tech/intern_fancom20/dsp.png" >}}

DSPがやることをまとめると、
1. SSPからのリクエストを受け取る
2. データベースから入っている広告データをn個取ってくる
3. n個の広告のうち、リクエストしてきたアプリケーションをブロック対象としている広告を除外する  
(競合アプリに広告出したりはしないですよね、多分) 
4. 除外後の広告達を機械学習APIに投げ、それぞれの入札金額を決定してもらう
5. SSPのリクエストで指定されていた最低入札金額よりも低い金額の広告を除外
6. 残った広告の中で最も高い入札金額の広告をSSPに返却する

このような流れになります。  

その他DSPが行う作業として、  
- アプリケーションから表示完了の通知を受け取る
- アプリケーションから広告をクリックしたという通知を受け取る
- 全てのリクエスト・レスポンスのログを出力する

などが今回要求されました。

私が今回製作したmini-dspはプログラム部分は全てRustを使って実装しており、  
シンプルな設計と速度が特徴となっています。  

## 1日目
10時にメンターの方と顔合わせのミーティングを行い、  
そのまま課題についての説明をしていただきました。  
先ほどのDSPとSSPなどの仕組みの話は全く知らなかったので、この説明がなければ死んでいたと思います。  
感謝ですね…！

課題説明が40〜50分くらいで終わったので、  
その後に実装の簡単な段取りを考えました。

- リクエストを受け取って適当なレスポンスを返すサーバ部分を書く
- 機械学習APIのモックを作る
- ログ機能を実装する
- イベント通知を受け取る機能を書く
- DBから広告を取得する部分を書く

大体これを一日1つ〜2つ実装していけば終わりそうかな、という見積もりでした。  

ここまでが午前中の話で、午後からは実装に入りました。

1日目の実装はサーバと機械学習APIのモックの作成でした。  

サーバはRustの軽量・高速なWebフレームワークである[actix-web](https://actix.rs)を使いました。
{{< figure src="/img/tech/intern_fancom20/actix.png" link="https://actix.rs" >}}  
初めて使う上に、アップデートが激しいため見つかる参考資料も古いものが多くそこそこ苦労しましたが、とりあえず動く状態まで実装することができました。

17時を目処にプルリクを投げ、ミーティングでコードレビューをしていただきました。

## 2日目
2日目は特にミーティングを行うこともなく朝から実装に入りました。  
この日の実装は主にログ出力機能とイベント通知受け取り部分でした。

ログ書き出し用の構造体を作るときに上手いことトレイトを利用して簡潔に実装することができて、  
自分的には結構いい感じで書けたのでは、と思います。  

ログに出力する可能性のある構造体はToLogトレイトを実装するだけでログを吐き出す関数の引数に渡すことができるようになるような設計にしていて、このあとイベント通知受け取り部分を実装したときもログ部分をほとんど書き換えずにすみました。

イベント通知受け取り部分に関しては、ログを吐くための構造体を書いた後、1日目に作ったサーバ部分のコードに少し書き足すだけで終わりました。

## 3~4日目
この2日間でDB接続部分を実装しました。  
DBにPostgreSQLとRustのORMにdieselを利用しています。  
当然これも初めて(というかDB使ったことなかった)なので、  
悪戦苦闘しながら動かしていました。  
幸い手元に[実践Rust入門](https://www.amazon.co.jp/dp/B07QVQ7RDG/ref=cm_sw_r_tw_dp_x_s6MmFbZSJC62S)(自転車本)があり、この本の11章にDBと連携してアプリケーションを作る内容が載っていたのでめちゃめちゃに参考にしながら書いていきました。

折角なのでDockerの知識をつけようと思いDocker環境で動くようにdocker-composeを書いていましたが、なかなかに分からず、丸2日溶かしてしまいました。

まあ沼るのは割と分かっていたので先に書けるところを書いていてよかったなぁ、という感想でした。  
計画勝ちみたいなものですね。

## 最終日
最終日は座談会と資料作成、発表を行いました。  

座談会ではZoomでファンコミュニケーションズさんに関する様々な質問をしたり、  
技術系の雑談に近い話をしたりしていました。  
どこの技術系イベントに行っても思うんですけど、やっぱり実際にエンジニアをやっていらっしゃる方々の話は本当に面白いので、いつも聞き入ってしまう感があります。  
座談会はとても楽しい時間でした。

それが終わるとプレゼン発表用の資料の作成を行いました。  
そこそこ気合を入れて作ったので2〜3時間くらいかかったと思います。  
作り終わるとメンターの方々にレビューをしていただき、そこからさらに資料を改良しました。

プレゼンでの成果発表はオンラインで行いました。  
僕はサークルで結構オンラインでLTなどを行っていたので  
割とオンライン発表に慣れていたので、そこまで緊張はしませんでしたが、  
慣れてなかったら辛かっただろうなと思います。  
オンラインでプレゼンするの、反応が返ってこないので最初かなりやりにくいですよね。

実演も事前に撮った動画を使ってグダらないよう気をつけました。

{{< figure src="/img/tech/intern_fancom20/presen.png" >}}


## インターンの感想
感想ですが、まず普段趣味で書いてるのが活きた場面が結構あって、驚きました。  
2日目のようにトレイトを使って上手いこと抽象化したり、  
競技プログラミングでやってる感じで計算量をそれほど大きくせずにより簡潔に書いたりなど、普段やっていることが実際に動くものを作るときにもそのまま役立ったのはとても嬉しかったです。

次に、初めて使う技術が多かったが思ったより苦労せず使えた、というのがあります。  
いやまあ苦労したのは苦労したのですが、それでも最終的に動く状態までたどり着けて、  
何も分からないみたいな状態でもそれなりに動かすことができるものなのだなぁと感じました。それとドキュメントの読み方の感覚とかも結構分かってきた感があります。  
このあたりは普段の趣味プログラミングでは僕はあまりやらない範囲なので貴重な経験ができたと思います。

後は、好きな言語で実際に業務っぽい動くプログラムが書けたのが良かったと思います。  
結局最終的にはコード書いてれば楽しいタイプの人間なので、Rustで書かせてくれるのが本当に楽しかったです。

## 最後に
5日間という本当に短い期間でしたが、  
すごく楽しい時間となりました。

オンラインインターンなので細かい質問の投げにくさであったり、  
実際の社内の雰囲気を感じ取ることが難しいという面もありますが、  
それでもメンターの方々や人事の方がとてもよくサポートしてくれて、  
これはこれでいい経験になったのではないかな、と考えています。  
(これからもオンラインのインターンや仕事は増えそうですし。)

機会があればぜひまた参加したいと思えるインターンでした。  
本当にありがとうございました！
